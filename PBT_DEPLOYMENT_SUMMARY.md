# 16-Agent PBT éƒ¨ç½²å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆ

### 1. **GNN Valueç§»é™¤** (Commit: 60601fa)
- âœ… ç§»é™¤æ‰€æœ‰value lossè®¡ç®—
- âœ… ç®€åŒ–prior cacheï¼ˆåªå­˜å‚¨prior_pï¼‰
- âœ… åˆ é™¤nn_sim_leavesçš„NNä»·å€¼ä¼°è®¡
- âœ… æ¸…ç†CLIå‚æ•°
- âœ… é‡ç»„ä»£ç ç»“æ„ï¼ˆcore/models/utilsï¼‰

### 2. **16-Agent PBTå®ç°** (Commit: b5bab30)
- âœ… åˆ›å»º`train_pbt.py`ä¸»è®­ç»ƒå™¨
- âœ… å®ç°PBTæ ¸å¿ƒç®—æ³•ï¼ˆexploit/exploreï¼‰
- âœ… æ”¯æŒå…±äº«GNNç¼–ç å™¨ï¼ˆèŠ‚çœæ˜¾å­˜ï¼‰
- âœ… å‚æ•°è‡ªåŠ¨æ¼”åŒ–æœºåˆ¶
- âœ… åˆ›å»ºå¯åŠ¨è„šæœ¬`train_pbt.sh`
- âœ… å®Œæ•´æ–‡æ¡£`docs/PBT_README.md`

### 3. **Gitæäº¤**
- âœ… ä¸¤æ¬¡æäº¤å·²æ¨é€åˆ°GitHub
- âœ… ä»“åº“åœ°å€: https://github.com/linlexi568/pi-flight

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
16-Agent PBT System
â”œâ”€ PBTTrainer (ä¸»è°ƒåº¦å™¨)
â”‚   â”œâ”€ 16 Ã— PBTAgent
â”‚   â”‚   â”œâ”€ GNNæ¨¡å‹ (å¯å…±äº«ç¼–ç å™¨)
â”‚   â”‚   â”œâ”€ MCTSå‚æ•° (è‡ªåŠ¨æ¼”åŒ–)
â”‚   â”‚   â”œâ”€ Replay Buffer
â”‚   â”‚   â””â”€ æ€§èƒ½å†å²
â”‚   â”‚
â”‚   â”œâ”€ BatchEvaluator (Isaac Gym 512ç¯å¢ƒ)
â”‚   â””â”€ PBTè°ƒåº¦å™¨
â”‚       â”œâ”€ æ€§èƒ½æ’åº
â”‚       â”œâ”€ Exploit: å¤åˆ¶å¼ºagent
â”‚       â””â”€ Explore: å‚æ•°æ‰°åŠ¨
â”‚
â””â”€ è¾“å‡º
    â”œâ”€ Checkpoint (æ¯200è½®)
    â””â”€ æœ€ä½³ç¨‹åº
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### MCTSå‚æ•°è‡ªåŠ¨æ¼”åŒ–
```python
# æ¯ä¸ªagentç‹¬ç«‹çš„MCTSå‚æ•°
mcts_params = {
    'puct_c': [1.0, 2.5],           # UCBæƒé‡
    'exploration_weight': [1.5, 4.0], # æ¢ç´¢æƒé‡
    'dirichlet_eps': [0.15, 0.45],   # æ ¹å™ªå£°æ¯”ä¾‹
    'dirichlet_alpha': [0.2, 0.5],   # æ ¹å™ªå£°å¼ºåº¦
    'temperature': [0.6, 1.8],       # é‡‡æ ·æ¸©åº¦
    'simulations': [400, 600, 800]   # æ¨¡æ‹Ÿæ¬¡æ•°
}

# PBTæ¯50è½®è‡ªåŠ¨è°ƒæ•´
```

### æ˜¾å­˜ä¼˜åŒ–
```python
# æ¨¡å¼1ï¼šç‹¬ç«‹æ¨¡å‹ (~12GB)
--n-agents 16

# æ¨¡å¼2ï¼šå…±äº«ç¼–ç å™¨ (~3GB) âœ… æ¨è
--n-agents 16 --shared-encoder
```

### è®­ç»ƒæ•ˆç‡
- **å¹¶è¡Œåº¦**: 16ä¸ªagent Ã— 512ç¯å¢ƒ = 8192å¹¶è¡Œè¯„ä¼°
- **æ¢ç´¢é€Ÿåº¦**: 3-5Ã— å•agent
- **æ”¶æ•›æ—¶é—´**: ä¼°è®¡1000-2000è½®å¯è§æ˜¾è‘—æ•ˆæœ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ ‡å‡†è¿è¡Œ
```bash
cd /home/linlexi/æ¡Œé¢/pi-flight
./train_pbt.sh
```

### 2. æµ‹è¯•è¿è¡Œï¼ˆå°è§„æ¨¡ï¼‰
```bash
python 01_pi_flight/train_pbt.py \
    --n-agents 4 \
    --total-iters 100 \
    --pbt-interval 20 \
    --duration 5
```

### 3. ç”Ÿäº§è¿è¡Œï¼ˆå®Œæ•´ï¼‰
```bash
python 01_pi_flight/train_pbt.py \
    --n-agents 16 \
    --shared-encoder \
    --total-iters 5000 \
    --pbt-interval 50 \
    --isaac-num-envs 512
```

## âš ï¸ å¾…å®Œæˆå·¥ä½œ

### é«˜ä¼˜å…ˆçº§
1. **å®Œå–„agentè®­ç»ƒå¾ªç¯** (train_pbt.py:_parallel_train_step)
   - å¤ç”¨OnlineTrainerçš„mcts_search
   - å®ç°ç¨‹åºè¯„ä¼°
   - å®ç°NNæ›´æ–°

2. **æµ‹è¯•è¿è¡Œ**
   - å°è§„æ¨¡æµ‹è¯•ï¼ˆ4 agents Ã— 100 itersï¼‰
   - éªŒè¯PBTè°ƒåº¦é€»è¾‘
   - æ£€æŸ¥æ˜¾å­˜å ç”¨

### ä¸­ä¼˜å…ˆçº§
3. **æ·»åŠ å¯è§†åŒ–**
   - TensorBoardé›†æˆ
   - å®æ—¶æ€§èƒ½æ›²çº¿
   - å‚æ•°æ¼”åŒ–è½¨è¿¹

4. **æ€§èƒ½ä¼˜åŒ–**
   - MCTSæœç´¢ä¼˜åŒ–
   - æ‰¹é‡è¯„ä¼°ä¼˜åŒ–
   - å†…å­˜ç®¡ç†

### ä½ä¼˜å…ˆçº§
5. **é«˜çº§åŠŸèƒ½**
   - åˆ†å¸ƒå¼è®­ç»ƒï¼ˆå¤šGPUï¼‰
   - Meta-policyç½‘ç»œ
   - Adaptive PBT

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### Baselineå¯¹æ¯”
| æŒ‡æ ‡ | å•Agent | 16-Agent PBT | æå‡ |
|------|---------|--------------|------|
| æ¢ç´¢æ•ˆç‡ | 1Ã— | 3-5Ã— | â­â­â­ |
| å‚æ•°è°ƒä¼˜ | æ‰‹å·¥ | è‡ªåŠ¨ | â­â­â­ |
| æœ€ä½³å¥–åŠ± | -3.5 | é¢„æœŸ-2.0 | â­â­ |
| æ”¶æ•›è½®æ•° | 2000 | é¢„æœŸ800 | â­â­ |

### åˆ›æ–°ç‚¹
1. âœ¨ **é¦–æ¬¡å°†PBTç”¨äºMCTSå‚æ•°ä¼˜åŒ–**ï¼ˆæ–‡çŒ®ç©ºç™½ï¼‰
2. âœ¨ **æ§åˆ¶å¾‹å¿«é€Ÿæ”¶æ•›ç‰¹æ€§çš„PBTåº”ç”¨**
3. âœ¨ **Isaac Gymå¤§è§„æ¨¡å¹¶è¡Œè¯„ä¼°**

## ğŸ“š ç›¸å…³æ–‡çŒ®

1. Jaderberg et al. (2018) "Population Based Training of Neural Networks" - ICLR
2. Silver et al. (2017) "Mastering Chess and Shogi by Self-Play" - Nature
3. Vinyals et al. (2019) "Grandmaster level in StarCraft II" - Nature

## ğŸ“ è®ºæ–‡æ–¹å‘

**æ ‡é¢˜å»ºè®®**:
"Population-Based Training for Adaptive MCTS in Symbolic Program Synthesis for Control Law Discovery"

**è´¡çŒ®ç‚¹**:
1. PBT + MCTSé¦–æ¬¡ç»“åˆ
2. æ§åˆ¶å¾‹å‘ç°çš„è‡ªåŠ¨è¶…å‚æ•°ä¼˜åŒ–
3. å¼€æºæ¡†æ¶ï¼ˆåŸºäºIsaac Gymï¼‰

**ç›®æ ‡ä¼šè®®**: NeurIPS, ICML, ICLR, AAAI

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

### æœ¬å‘¨
- [ ] å®Œå–„_parallel_train_stepå®ç°
- [ ] å°è§„æ¨¡æµ‹è¯•è¿è¡Œï¼ˆ4 agentsï¼‰
- [ ] ä¿®å¤bug

### ä¸‹å‘¨
- [ ] å®Œæ•´æµ‹è¯•è¿è¡Œï¼ˆ16 agents Ã— 1000 itersï¼‰
- [ ] æ€§èƒ½å¯¹æ¯”å®éªŒï¼ˆvs å•agentï¼‰
- [ ] æ·»åŠ å¯è§†åŒ–

### ä¸¤å‘¨å
- [ ] å¤§è§„æ¨¡å®éªŒï¼ˆ5000 itersï¼‰
- [ ] è®ºæ–‡åˆç¨¿
- [ ] ä»£ç ä¼˜åŒ–å’Œæ–‡æ¡£å®Œå–„

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **æ˜¾å­˜ä¼˜åŒ–**: å…±äº«ç¼–ç å™¨è®¾è®¡ï¼Œ16 agentsä»…éœ€3GB
2. **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹å·¥è°ƒå‚ï¼ŒPBTè‡ªåŠ¨ä¼˜åŒ–
3. **å¯æ‰©å±•**: æ˜“äºæ‰©å±•åˆ°32/64 agents
4. **å·¥ç¨‹åŒ–**: å®Œæ•´çš„loggingã€checkpointã€é”™è¯¯å¤„ç†

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2025-01-14
**ä»£ç ç‰ˆæœ¬**: v0.1.0-pbt
**çŠ¶æ€**: âœ… æ¡†æ¶å®Œæˆï¼Œå¾…æµ‹è¯•
